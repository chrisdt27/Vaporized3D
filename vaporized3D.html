<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Vaporized â€” Choice System</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  /* [ALL YOUR EXISTING CSS STYLES - KEEP THEM EXACTLY AS IS] */
  :root {
    --bg:#000; --fg:#fff; --muted:#bbb;
    --accent:#23c2ff; --warn:#6a2c2c; --card:#111; --border:#333;
  }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Arial;overflow:hidden}
  /* ... include ALL your existing CSS styles ... */
</style>
</head>
<body>
  <!-- [ALL YOUR EXISTING HTML - KEEP IT EXACTLY AS IS] -->
  <div id="loading">...</div>
  <button id="vrToggle">Enter VR</button>
  <!-- ... include ALL your existing HTML structure ... -->

<script>
  // -------- Paths ----------
  const INTRO      = 'assets/00_intro_1080p24.mp4';
  const PARKING    = 'assets/01_parking_offer_1080p24.mp4';
  const TO_VR      = 'journeys/mouth_Oculus.html';
  const TO_CLASSROOM = '../vape_on_the_brain_vr/Classroom/classroom_scene.html';

  // -------- DOM Elements ----------
  // [KEEP ALL YOUR EXISTING DOM VARIABLES]

  // -------- State ----------
  let transitionTriggered = false;

  // -------- VIDEO FIX: Create new video elements programmatically ----------
  function createAndPlayVideo(src, onEnded) {
    return new Promise((resolve) => {
      console.log(`ðŸŽ¬ Creating new video element for: ${src}`);
      
      // Create a completely new video element
      const video = document.createElement('video');
      video.src = src;
      video.muted = true;
      video.playsInline = true;
      video.style.width = '100%';
      video.style.height = '100%';
      video.style.objectFit = 'cover';
      video.style.position = 'fixed';
      video.style.top = '0';
      video.style.left = '0';
      video.style.zIndex = '9999';
      
      // Add to body
      document.body.appendChild(video);
      
      // Try to play immediately
      video.play().then(() => {
        console.log(`âœ… Video playing successfully: ${src}`);
        
        video.addEventListener('ended', () => {
          console.log(`ðŸ“º Video ended: ${src}`);
          document.body.removeChild(video);
          if (onEnded) onEnded();
          resolve();
        });
        
      }).catch(error => {
        console.log(`âŒ Video play failed: ${src}`, error);
        
        // Fallback: Remove video and continue
        document.body.removeChild(video);
        if (onEnded) onEnded();
        resolve();
      });
    });
  }

  // -------- MODIFIED TRANSITION FUNCTIONS ----------
  function transitionToIntroVideo() {
    if (!transitionTriggered) {
      transitionTriggered = true;
      console.log('Star Wars intro completed - transitioning to intro video');
      
      // Hide star wars intro
      document.getElementById('starwars-intro').style.display = 'none';
      document.getElementById('scene-progress').textContent = 'Scene 2/3';
      
      // Use the new video method
      createAndPlayVideo(INTRO, () => {
        console.log('Intro video completed - transitioning to parking lot scene');
        transitionToNextScene();
      });
    }
  }
  
  function transitionToNextScene() {
    console.log('Transitioning to parking lot scene');
    document.getElementById('scene-progress').textContent = 'Scene 3/3';
    
    // Use the new video method
    createAndPlayVideo(PARKING, () => {
      console.log('Parking lot scene completed - showing choice interface');
      document.getElementById('scene-progress').style.display = 'none';
      document.getElementById('choice').style.display = 'flex';
    });
  }

  // -------- SIMPLIFIED INITIALIZATION ----------
  async function init() {
    try {
      console.log('ðŸ” Checking assets...');
      const assets = [INTRO, PARKING];
      
      for (const asset of assets) {
        try {
          const response = await fetch(asset, { method: 'HEAD' });
          console.log(`${response.ok ? 'âœ…' : 'âŒ'} ${asset}`);
        } catch (error) {
          console.log(`âŒ ${asset}`);
        }
      }
      
      // Initialize Star Wars intro
      createStarfield();
      
      // Set up crawl completion handler
      document.getElementById('crawl-content').addEventListener('animationend', () => {
        console.log('Crawl animation ended');
        transitionToIntroVideo();
      });
      
      // Set up skip button
      document.getElementById('skipIntro').addEventListener('click', () => {
        console.log('Skip button clicked');
        document.getElementById('crawl-content').style.animation = 'none';
        transitionToIntroVideo();
      });
      
      // Hide loading screen
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('fade').classList.add('hidden');
      }, 1000);
      
      console.log('Star Wars intro started');
      
    } catch(e) {
      console.error('Init error:', e);
      document.getElementById('loading').style.display = 'none';
      document.getElementById('starwars-intro').style.display = 'none';
      document.getElementById('choice').style.display = 'flex';
    }
  }

  // -------- KEEP ALL YOUR EXISTING FUNCTIONS BUT SIMPLIFY ----------
  function createStarfield() {
    const starfield = document.getElementById('starfield');
    for (let i = 0; i < 150; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.width = Math.random() * 2 + 'px';
      star.style.height = star.style.width;
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.opacity = Math.random() * 0.7 + 0.3;
      starfield.appendChild(star);
    }
  }

  // [KEEP ALL YOUR OTHER EXISTING FUNCTIONS BUT THEY WON'T BE USED FOR VIDEO PLAYBACK]
  function showChoice(){ 
    document.getElementById('choice').style.display = 'flex'; 
  }
  
  function fadeAndGo(url){ 
    document.getElementById('fade').classList.remove('hidden');
    setTimeout(() => { window.location = url; }, 600); 
  }

  // -------- EVENT LISTENERS ----------
  window.addEventListener('load', init);

  // [KEEP ALL YOUR EXISTING EVENT LISTENERS]
  document.getElementById('btnVR').addEventListener('click', () => {
    document.getElementById('negativeConsequence').style.display = 'flex';
    // ... rest of your consequence logic
  });
  
  document.getElementById('btnNo').addEventListener('click', () => {
    document.getElementById('positiveConsequence').style.display = 'flex';
    // ... rest of your consequence logic
  });

  // [INCLUDE ALL YOUR OTHER EVENT LISTENERS]

</script>
</body>
</html>
